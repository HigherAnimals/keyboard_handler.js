var KeyboardHandler,KeyboardState,KeyState;KeyboardHandler=function(a,b){var c;this._element=a,this._prevent=!!b,this._keyboardState=new KeyboardState,c=a.addEventListener||a.attachEvent,this._boundHandleKeyUp=function(a){return function(b){a._handleKeyUp(b)}}(this),this._boundHandleKeyDown=function(a){return function(b){a._handleKeyDown(b)}}(this),this._boundHandleKeyPress=function(a){return function(b){a._handleKeyPress(b)}}(this),c.call(a,"keydown",this._boundHandleKeyDown,!1),c.call(a,"keypress",this._boundHandleKeyPress,!1),c.call(a,"keyup",this._boundHandleKeyUp,!1)},KeyboardHandler.prototype.getKeyboardState=function(a){var b;return b=this._keyboardState.clone(),a||this._keyboardState.hold(),b},KeyboardHandler.prototype.dispose=function(){var a;a=this._element.removeEventListener||this._element.detachEvent,a.call(this._element,"keydown",this._boundKeyHandleKeyDown,!1),a.call(this._element,"keypress",this._boundHandleKeyPress,!1),a.call(this._element,"keyup",this._boundHandleKeyUp,!1),this._element=null,delete this._boundHandleKeyDown,delete this._boundHandleKeyPress,delete this._boundHandleKeyUp},KeyboardHandler.prototype._handleKeyDown=function(a){this._keyboardState.press(KeyboardHandler.getKeyCode(a)),this._prevent&&a.preventDefault()},KeyboardHandler.prototype._handleKeyUp=function(a){this._keyboardState.release(KeyboardHandler.getKeyCode(a)),this._prevent&&a.preventDefault()},KeyboardHandler.prototype._handleKeyPress=function(a){console.log("asdf"),this._prevent&&a.preventDefault()},KeyboardHandler.getKeyCode=function(a){var b;return b=a||window.event,b.keyCode||b.which},KeyState=function(a,b,c){this.pressed=!!a,this.presses=b||0,this.duration=c||0},KeyState.prototype.clone=function(){return new KeyState(this.pressed,this.presses,this.duration)},KeyboardState=function(){this._keyStates=[]},KeyboardState.prototype.clone=function(){var a,b,c;c=new KeyboardState,a=this._keyStates.length;while(a--)(b=this._keyStates[a])&&c.setKeyState(a,b.clone());return c},KeyboardState.prototype.setKeyState=function(a,b){this._keyStates[a]=b},KeyboardState.prototype.getKeyState=function(a){return this._keyStates[a]||(this._keyStates[a]=new KeyState)},KeyboardState.prototype.press=function(a){var b;b=this.getKeyState(a),b.pressed=!0,b.presses++},KeyboardState.prototype.release=function(a){var b;b=this.getKeyState(a),b.pressed=!1,b.duration=0},KeyboardState.prototype.hold=function(){var a,b;a=this._keyStates.length;while(a--)if(b=this._keyStates[a])b.presses=0,b.pressed&&b.duration++},KeyboardState.prototype.isPressed=function(a){var b;return(b=this._keyStates[a])?b.pressed:!1},KeyboardState.prototype.isHeld=function(a){var b;return this.isPressed(a)&&((b=this._keyStates[a])?!!b.duration:!1)}